<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aave é£æ§æŸ¥è¯¢å™¨</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        input { width: 70%; padding: 10px; font-size: 16px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; background: #007bff; color: white; border: none; }
        button:disabled { background: #ccc; }
        #result { margin-top: 20px; padding: 15px; border: 1px solid #ddd; display: none; }
        .risk { color: orange; font-weight: bold; }
        .liquidation { color: red; font-weight: bold; }
        .safe { color: green; font-weight: bold; }
    </style>
</head>
<body>
    <h1>ğŸ¦ Aave V3 é£é™©ç›‘è§†å™¨</h1>
    <p>è¾“å…¥ä»¥å¤ªåŠé’±åŒ…åœ°å€ï¼ŒæŸ¥è¯¢é£æ§çŠ¶å†µ</p>
    
    <div>
        <input type="text" id="addressInput" placeholder="è¾“å…¥ 0x å¼€å¤´çš„åœ°å€..." value="0xC4668E8c8b5CB6f043d1D5f147C6E2c75556455C" />
        <button onclick="checkRisk()" id="btn">æŸ¥è¯¢</button>
    </div>

    <div id="result">
        <p>æ€»æŠµæŠ¼: <span id="collateral"></span> USD</p>
        <p>æ€»å€ºåŠ¡: <span id="debt"></span> USD</p>
        <p>å¥åº·å› å­: <span id="hf"></span></p>
        <p>çŠ¶æ€: <span id="status"></span></p>
    </div>

    <script>
        async function checkRisk() {
            const address = document.getElementById('addressInput').value;
            const btn = document.getElementById('btn');
            const resultDiv = document.getElementById('result');
            
            if (!address) return alert("è¯·è¾“å…¥åœ°å€");

            btn.disabled = true;
            btn.innerText = "æŸ¥è¯¢ä¸­...";
            resultDiv.style.display = "none";

            try {
                // ä¸ºäº†ç®€å•æ¼”ç¤ºï¼Œåªè¿è¡Œåˆšæ‰çš„ server.ts æ¥å£
                
                // æ³¨æ„ï¼šè¿™é‡Œæ˜¯è°ƒç”¨æœ¬åœ°æµ‹è¯•ï¼Œéƒ¨ç½²åçœ‹ç¬¬ä¸‰é˜¶æ®µ
                const response = await fetch(`/api/risk?address=${address}`);
                const data = await response.json();

                if (data.error) {
                    alert("å‡ºé”™: " + data.error);
                } else {
                    document.getElementById('collateral').innerText = data.totalCollateralUSD;
                    document.getElementById('debt').innerText = data.totalDebtUSD;
                    document.getElementById('hf').innerText = data.healthFactor;
                    
                    const statusSpan = document.getElementById('status');
                    statusSpan.innerText = data.riskStatus.toUpperCase();
                    statusSpan.className = data.riskStatus;
                    
                    resultDiv.style.display = "block";
                }
            } catch (e) {
                alert("ç½‘ç»œè¯·æ±‚å¤±è´¥");
            } finally {
                btn.disabled = false;
                btn.innerText = "æŸ¥è¯¢";
            }
        }
    </script>
</body>
</html>